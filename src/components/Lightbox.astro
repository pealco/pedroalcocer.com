---
import type { Photo } from '../data/photos';

interface Props {
  photos: Photo[];
}

const { photos } = Astro.props;
---

<div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Photo viewer">
  <button class="lightbox-close" aria-label="Close">&times;</button>
  <button class="lightbox-prev" aria-label="Previous photo">&lsaquo;</button>
  <button class="lightbox-next" aria-label="Next photo">&rsaquo;</button>
  <img class="lightbox-img" src="" alt="" />
</div>

<style>
  .lightbox {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.95);
    align-items: center;
    justify-content: center;
  }

  .lightbox.open {
    display: flex;
  }

  .lightbox-img {
    max-height: 90vh;
    max-width: 95vw;
    object-fit: contain;
  }

  .lightbox-close,
  .lightbox-prev,
  .lightbox-next {
    position: fixed;
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: color 0.2s;
    font-family: system-ui, sans-serif;
  }

  .lightbox-close:hover,
  .lightbox-prev:hover,
  .lightbox-next:hover {
    color: #fff;
  }

  .lightbox-close {
    top: 1rem;
    right: 1.5rem;
    font-size: 2rem;
    line-height: 1;
    padding: 0.5rem;
  }

  .lightbox-prev,
  .lightbox-next {
    top: 50%;
    transform: translateY(-50%);
    font-size: 3rem;
    line-height: 1;
    padding: 0.5rem 1rem;
  }

  .lightbox-prev {
    left: 1rem;
  }

  .lightbox-next {
    right: 1rem;
  }
</style>

<script is:inline define:vars={{ photos }}>
  const lightbox = document.getElementById('lightbox');
  const img = lightbox.querySelector('.lightbox-img');
  const closeBtn = lightbox.querySelector('.lightbox-close');
  const prevBtn = lightbox.querySelector('.lightbox-prev');
  const nextBtn = lightbox.querySelector('.lightbox-next');
  let currentIndex = 0;

  function show(index) {
    currentIndex = index;
    const photo = photos[currentIndex];
    img.src = photo.src;
    img.alt = photo.alt;
    lightbox.classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function close() {
    lightbox.classList.remove('open');
    document.body.style.overflow = '';
    img.src = '';
  }

  function prev() {
    show((currentIndex - 1 + photos.length) % photos.length);
  }

  function next() {
    show((currentIndex + 1) % photos.length);
  }

  closeBtn.addEventListener('click', close);
  prevBtn.addEventListener('click', prev);
  nextBtn.addEventListener('click', next);

  lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox) close();
  });

  document.addEventListener('keydown', (e) => {
    if (!lightbox.classList.contains('open')) return;
    if (e.key === 'Escape') close();
    if (e.key === 'ArrowLeft') prev();
    if (e.key === 'ArrowRight') next();
  });

  window.__lightboxShow = show;
</script>
